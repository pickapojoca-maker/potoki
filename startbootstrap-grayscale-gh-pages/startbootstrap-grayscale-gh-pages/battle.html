<!DOCTYPE html>
<html lang="sl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Bitka – podrobnosti</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- (neobvezno) tvoj glavni CSS -->
  <link href="css/styles.css" rel="stylesheet">

  <style>
    :root { --paper:#fffdf6; --ink:#222; }
    body { background:#0f0f10; color:#e9ecef; }
    .hero {
      background: radial-gradient(1200px 500px at 10% 0%, rgba(255,255,255,.06), transparent),
                  linear-gradient(180deg, #1b1b1d, #0f0f10);
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .paper {
      background: var(--paper); color:var(--ink);
      border-radius: 14px; padding: 24px;
      box-shadow: 0 15px 40px rgba(0,0,0,.25);
      border: 1px solid #e7dcc7;
    }
    .crumb a { color:#adb5bd; text-decoration:none }
    .crumb a:hover { color:#fff; }
    .pill { background:#2b3035; color:#ced4da; border-radius: 999px; padding:2px 10px; font-size:12px; }
    .lead-muted { color:#6c757d; }
    .sep { border-top:1px dashed #e7dcc7; opacity:.8; }
    #hero img { max-height: 520px; object-fit: contain; background:#f8f9fa; }
  </style>
</head>
<body>
  <header class="hero py-4">
    <div class="container d-flex align-items-center justify-content-between">
      <div class="crumb small">
        <a href="index.html#about">← Nazaj na zemljevid</a>
      </div>
      <div class="pill">Zgodovina • 1850–1914</div>
    </div>
  </header>

  <main class="container my-4">
    <div class="paper">
      <h1 id="t" class="mb-2">Nalaganje…</h1>
      <p id="meta" class="lead lead-muted"></p>

      <!-- SLIKA (če obstaja za ta ID) -->
      <figure id="hero" class="mt-2 text-center d-none">
        <img id="heroImg" class="img-fluid rounded shadow" alt="" loading="lazy">
        <figcaption id="heroCap" class="text-muted small mt-2"></figcaption>
      </figure>

      <hr class="my-4 sep">

      <!-- SAMO DALJŠI OPIS iz .txt (brez naslova) -->
      <section>
        <div id="full">—</div>
      </section>
    </div>
  </main>

  <script>
    // ====== META podatki ======
    const META = {
      "sevastopol": { title:"Obleganje Sevastopola (Krimska vojna)", place:"Sevastopol, Krim", date:"1854–1855" },
      "sedan": { title:"Bitka pri Sedanu (francosko-pruska vojna)", place:"Sedan, Francija", date:"1870" },
      "obleganje-pariza": { title:"Obleganje Pariza", place:"Pariz, Francija", date:"1870–1871" },
      "rusko-japonska-vojna": { title:"Rusko-japonska vojna", place:"Port Arthur • Mukden • Tsushima", date:"1904–1905" },
      "boksarska-vstaja": { title:"Boksarska vstaja – obleganje Pekinga", place:"Peking, Kitajska", date:"1899–1901" },
      "burska-vojna": { title:"Burska vojna", place:"Južna Afrika", date:"1899–1902" },
      "druga-maroska-kriza": { title:"Druga maroška kriza", place:"Agadir, Maroko", date:"1905–1911" },
      "amerisko-spanska-vojna": { title:"Ameriško-španska vojna", place:"Kuba in Filipini", date:"1898" },
      "balkanski-vojni": { title:"Prva in druga balkanska vojna", place:"Balkan", date:"1912–1913" },
      "aneksija-bih": { title:"Aneksija Bosne in Hercegovine", place:"Sarajevo in BiH", date:"1908–1909" },
      "sedemtedenska-vojna": { title:"Bitka pri Kraljevem Gradcu (Sedemtedenska)", place:"Hradec Králové, Češka", date:"1866" },
      "mladoturska-revolucija": { title:"Mladoturška revolucija", place:"Solun & Carigrad", date:"1908" },
      "francosko-pruska-vojna": { title:"Francosko-pruska vojna – Gravelotte/St. Privat", place:"Metz, Francija", date:"16.–18. avg. 1870" }
    };

    // ====== Povezave na .txt ======
    const FILES = {
      "sevastopol": "Sevastopol.txt",
      "sedan": "Sedan.txt",
      "obleganje-pariza": "Obleganje Pariza.txt",
      "rusko-japonska-vojna": "Rusko-japonska vojna.txt",
      "boksarska-vstaja": "Boksarska vstaja.txt",
      "burska-vojna": "Burska vojna.txt",
      "druga-maroska-kriza": "Druga maroška kriza.txt",
      "amerisko-spanska-vojna": "Ameriško-španska vojna.txt",
      "balkanski-vojni": "Balkanski vojni.txt",
      "aneksija-bih": "Aneksija Bosne in Hercegovine.txt",
      "sedemtedenska-vojna": "Sedemtedenska vojna.txt",
      "mladoturska-revolucija": "Mladoturška revolucija.txt",
      "francosko-pruska-vojna": "Francosko pruska vojna.txt"
    };

    // ====== Slike (assets/img/art/) ======
    const IMAGES = {
      "aneksija-bih": "Aneksija v BIH.png",
      "balkanski-vojni": "Balkanska vojna.png",
      "sedan": "Bitka pri Sedanu.png",
      "boksarska-vstaja": "Boksarska vstaja.png",
      "burska-vojna": "Burska vojna.png",
      "druga-maroska-kriza": "Druga maroška kriza.png",
      "francosko-pruska-vojna": "Francosko Pruska vojna.png",
      "mladoturska-revolucija": "Mladoturška revolucija.png",
      "obleganje-pariza": "Obleganje Pariza.png",
      "rusko-japonska-vojna": "Rusko japonska vojna.png"
    };

    // ====== Pomožne ======
    function asciiFallback(name){ return name.normalize('NFD').replace(/[\u0300-\u036f]/g, '').replace(/\s+/g, '-'); }
    function textToHtmlParagraphs(txt){
      const clean = txt.replace(/\r/g,'').trim();
      const parts = clean.split(/\n\s*\n/).map(p => p.trim()).filter(Boolean);
      return parts.length ? '<p>' + parts.map(p => p.replace(/\n+/g,'<br>')).join('</p><p>') + '</p>'
                          : '<p>' + clean.replace(/\n+/g,'<br>') + '</p>';
    }
    function parseFullOnly(raw){
      const t = raw.replace(/\r/g,'');
      const m = /(^|\n)\s*VSE\s*\n/i;
      const mRes = t.match(m);
      if (mRes) {
        const start = t.search(m) + mRes[0].length;
        const full = t.slice(start).trim();
        if (full) return textToHtmlParagraphs(full);
      }
      return textToHtmlParagraphs(t.trim());
    }
    async function loadTextFile(path){
      const bases = ['/assets/text/', 'assets/text/'];
      const tries = [];
      for (const base of bases) {
        tries.push(base + encodeURIComponent(path), base + asciiFallback(path));
      }
      for (const url of tries) {
        try { const r = await fetch(url); if (r.ok) return await r.text(); } catch(e){}
      }
      throw new Error('Ni mogoče naložiti besedila iz: ' + tries.join(' | '));
    }

    // ====== Slike: robustno ======
    function fileBaseCandidates(id, metaTitle, declaredName){
      const list = [];
      if (declaredName) list.push(declaredName);
      if (metaTitle){
        const t = metaTitle.replace(/[^\p{L}\p{N}\s.-]/gu, '').trim();
        list.push(`${t}.png`,`${t}.jpg`,`${t}.jpeg`,`${t}.webp`);
        const ta = asciiFallback(t);
        list.push(`${ta}.png`,`${ta}.jpg`,`${ta}.jpeg`,`${ta}.webp`);
      }
      list.push(`${id}.png`,`${id}.jpg`,`${id}.jpeg`,`${id}.webp`);
      const ia = asciiFallback(id);
      list.push(`${ia}.png`,`${ia}.jpg`,`${ia}.jpeg`,`${ia}.webp`);
      const extra=[];
      for(const n of [...list]) if(n.includes(' ')){ extra.push(n.replace(/\s+/g,'-')); extra.push(n.replace(/\s+/g,'_')); }
      return Array.from(new Set([...list,...extra]));
    }
    function showImageFor(id, meta){
      const fig = document.getElementById('hero');
      const img = document.getElementById('heroImg');
      const cap = document.getElementById('heroCap');

      const declared = IMAGES[id];
      const candidates = fileBaseCandidates(id, meta?.title, declared);
      const folders = ['/assets/img/art/', 'assets/img/art/'];

      const urls = [];
      for (const folder of folders) {
        for (const base of candidates) {
          urls.push(folder + base);
          urls.push(folder + encodeURIComponent(base));
        }
      }

      let tried = [], idx = 0;
      function tryNext(){
        if (idx >= urls.length){
          fig.classList.remove('d-none'); img.remove();
          fig.innerHTML = `
            <div class="alert alert-warning text-start" role="alert">
              Slike ni mogoče naložiti. Preveri imena datotek v <code>/assets/img/art/</code>.<br>
              <small>Poskusil sem:<br>${tried.map(u=>`<code>${u}</code>`).join('<br>')}</small>
            </div>`;
          console.warn('Image candidates tried:', tried); return;
        }
        const url = urls[idx++]; tried.push(url);
        const probe = new Image();
        probe.onload = () => { img.src = url; img.alt = meta?.title || id; cap.textContent = meta ? `${meta.title} — ${meta.date}` : ''; fig.classList.remove('d-none'); };
        probe.onerror = tryNext; probe.src = url;
      }
      tryNext();
    }

    // ====== Loader ======
    (async function(){
      const $ = (id) => document.getElementById(id);
      const params = new URLSearchParams(location.search);
      const id = params.get('id');

      const meta = META[id];
      if (meta) {
        document.title = meta.title + ' – Imperializem';
        $('t').textContent = meta.title;
        $('meta').textContent = `${meta.place} • ${meta.date}`;
      } else {
        $('t').textContent = 'Neznana podstran';
      }

      showImageFor(id, meta);

      const filename = FILES[id];
      if (!filename) { $('full').innerHTML = '<p>Za ta ID ni povezane izvorne datoteke.</p>'; return; }

      try {
        const raw = await loadTextFile(filename);
        $('full').innerHTML = parseFullOnly(raw);
      } catch (err) {
        console.error(err);
        const hint = location.protocol === 'file:'
          ? '<p><b>Namig:</b> Če stran odpreš z dvojnim klikom (<code>file://</code>), brskalnik blokira branje datotek. Zaženi mini strežnik, npr.: <code>python -m http.server</code>, nato odpri <code>http://localhost:8000/battle.html?id='+ (id||'') +'</code>.</p>'
          : '';
        $('full').innerHTML = '<p>Ni mogoče naložiti besedila.</p>' + hint;
      }
    })();
  </script>
</body>
</html>
